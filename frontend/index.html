<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Cooperativa Musical</title>
    <link rel="stylesheet" href="/public/styles.css" />
</head>
<body>
<header>
    <h1>COOPERATIVA</h1>
    <nav>
        <a href="/novedades">Novedades</a>
        <a href="/redes">Redes Sociales</a>
    </nav>
</header>

<main class="card-container" id="card-container">
    <!-- Aquí se insertarán dinámicamente las tarjetas -->
</main>

<script>
    const ARTIST_IDS = [
      "7N2acqBH3hYNE7LF67N53y", // WNK
      "5Txb1Eoi4buQ8XQSLLQvil", // G.Aguiar
      "0fr32bvI5zFYxkrQ3GkBzy"  // Sousa
    ];

    const NOMBRES_ARTISTAS = {
      "7N2acqBH3hYNE7LF67N53y": {
        nombre: "WNK",
        genero: "Trap, Supertrap",
        bio: "Artista emergente de la escena urbana con letras oscuras y producción experimental. Fundador de la cooperativa.",
      },
      "5Txb1Eoi4buQ8XQSLLQvil": {
        nombre: "G.Aguiar",
        genero: "Trap melódico, Reggaetón oscuro",
        bio: "Productor y cantante versátil con un estilo que mezcla ritmos latinos y beats experimentales.",
      },
      "0fr32bvI5zFYxkrQ3GkBzy": {
        nombre: "Sousa",
        genero: "Supertrap, Electrónica urbana",
        bio: "Con influencias del techno y trap francés, su música destaca por atmósferas densas y letras introspectivas.",
      }
    };

    async function cargarArtistas() {
      try {
        const res = await fetch(`/api/spotify/artists?ids=${ARTIST_IDS.join(",")}`);
        const artistas = await res.json();
        const container = document.getElementById("card-container");

        artistas.forEach(artista => {
          const infoExtra = NOMBRES_ARTISTAS[artista.id];
          const card = document.createElement("div");
          card.className = "card";
          card.onclick = () => card.classList.toggle("flipped");

          const iframes = artista.topTracks.map(track => {
            const trackId = track.spotify_url.split("/track/")[1];
            return `
              <div style="margin-bottom: 12px;">
                <iframe style="border-radius:12px"
                        src="https://open.spotify.com/embed/track/${trackId}?utm_source=cooperativa"
                        width="100%" height="80" frameBorder="0" allowfullscreen
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                        loading="lazy">
                </iframe>
              </div>`;
          }).join("");

          card.innerHTML = `
            <div class="card-inner">
              <div class="card-front">
                <img src="${artista.imagen}" alt="${artista.nombre}" />
                <h2>${artista.nombre}</h2>
                <a href="${artista.urlSpotify}" target="_blank">Spotify</a>
              </div>
              <div class="card-back" style="background-image: url('${artista.imagen}'); background-size: cover;">
                <div class="overlay">
                  <h2>${artista.nombre}</h2>
                  <p><strong>Géneros:</strong> ${infoExtra.genero}</p>
                  <p><strong>Bio:</strong> ${infoExtra.bio}</p>
                  <p><strong>Top canciones:</strong></p>
                  ${iframes}
                  <button onclick="event.stopPropagation(); flipCard(this.closest('.card'))">Cerrar</button>
                </div>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (err) {
        console.error("Error al cargar artistas:", err);
      }
    }

    cargarArtistas();
</script>
</body>
</html>